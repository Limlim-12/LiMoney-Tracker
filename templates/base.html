<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>{% block title %}LiMoney Tracker{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='design.css') }}?v=2.1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600;700&display=swap"
    rel="stylesheet" />

  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
  <meta name="theme-color" content="#3b82f6" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-512.png') }}" />

  <script>
    // Only register the Service Worker if we are NOT on localhost
    if (
      window.location.hostname !== "127.0.0.1" &&
      window.location.hostname !== "localhost"
    ) {
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          // updateViaCache: 'none' forces the browser to check for a new sw.js every time
          navigator.serviceWorker
            .register("/sw.js", { updateViaCache: "none" })
            .then((reg) =>
              console.log("Service Worker Registered!", reg.scope)
            )
            .catch((err) => console.log("Service Worker Failed:", err));
        });
      }
    } else {
      console.log("Service Worker skipped on Localhost");
    }
  </script>

  <script>
    (function () {
      // 1. Check local storage for the theme
      const savedTheme = localStorage.getItem('theme') || 'light';

      // 2. Apply it to the HTML tag IMMEDIATELY
      document.documentElement.setAttribute('data-theme', savedTheme);
    })();
  </script>
</head>

<body class="app-body">
  <div class="app-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-icon">üí∞</div>
        <span class="logo-text">LiMoney</span>
      </div>

      <nav class="sidebar-nav">
        <a href="{{ url_for('dashboard') }}" class="nav-item {{ 'active' if request.endpoint == 'dashboard' }}">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          <span>Dashboard</span>
        </a>
        <a href="{{ url_for('budget_tracker') }}"
          class="nav-item {{ 'active' if request.endpoint == 'budget_tracker' }}">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
            <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
          </svg>
          <span>Budget</span>
        </a>
        <a href="{{ url_for('savings_tracker') }}"
          class="nav-item {{ 'active' if request.endpoint == 'savings_tracker' }}">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          <span>Savings</span>
        </a>
        <a href="{{ url_for('loan_tracker') }}" class="nav-item {{ 'active' if request.endpoint == 'loan_tracker' }}">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
            <line x1="1" y1="10" x2="23" y2="10"></line>
          </svg>
          <span>Loans</span>
        </a>
        <a href="{{ url_for('profile') }}" class="nav-item {{ 'active' if request.endpoint == 'profile' }}">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>Profile</span>
        </a>
      </nav>

      <button id="theme-toggle" class="nav-item theme-btn" onclick="toggleTheme()" style="
            background: transparent;
            border: none;
            cursor: pointer;
            text-align: left;
          ">
        <span id="theme-icon" style="margin-right: 12px">üåô</span>
        <span>Dark Mode</span>
      </button>

      <div class="sidebar-footer">
        <a href="{{ url_for('logout') }}" class="nav-item logout">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          <span>Logout</span>
        </a>
      </div>
    </aside>

    <main class="main-content">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="flash-container">
        {% for category, message in messages %}
        <div class="flash-toast {{ category }}">
          <span class="toast-icon">
            {{ '‚úÖ' if category == 'success' else '‚ö†Ô∏è' }}
          </span>
          <span class="toast-text">{{ message }}</span>
        </div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %} {% block content %}{% endblock %}
    </main>

    <nav class="bottom-nav">
     
    
      <a href="{{ url_for('budget_tracker') }}" class="b-nav-item {{ 'active' if request.endpoint == 'budget_tracker' }}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
          <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
        </svg>
      </a>
    
      
    
      <a href="{{ url_for('loan_tracker') }}" class="b-nav-item {{ 'active' if request.endpoint == 'loan_tracker' }}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
      </a>

      <div class="b-nav-fab-container">
        <a href="{{ url_for('dashboard') }}#add" class="b-nav-fab" title="Quick Add">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </a>
      </div>
    
      <a href="{{ url_for('savings_tracker') }}" class="b-nav-item {{ 'active' if request.endpoint == 'savings_tracker' }}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </a>
    
      <a href="{{ url_for('profile') }}" class="b-nav-item {{ 'active' if request.endpoint == 'profile' }}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </a>
    </nav>
  </div>

  <script>
    // 1. Auto-hide flash messages smoothly
    document.addEventListener("DOMContentLoaded", () => {
      const toasts = document.querySelectorAll(".flash-toast");
      toasts.forEach((toast, index) => {
        setTimeout(
          () => {
            toast.style.opacity = "0";
            toast.style.transform = "translateY(-20px)";
            setTimeout(() => toast.remove(), 500);
          },
          4000 + index * 500,
        );
      });
    });

    // 2. Theme Logic (Dark Mode)
    const htmlEl = document.documentElement;
    const themeBtn = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");

    // Check LocalStorage or System Preference on Load
    const currentTheme =
      localStorage.getItem("theme") ||
      (window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light");

    if (currentTheme === "dark") {
      htmlEl.setAttribute("data-theme", "dark");
      if (themeIcon) themeIcon.innerText = "‚òÄÔ∏è";
      if (themeBtn) {
        // Optional: update text if needed
        const span = themeBtn.querySelector("span:last-child");
        if (span) span.innerText = "Light Mode";
      }
    }

    // Toggle Function
    function toggleTheme() {
      const current = htmlEl.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";

      htmlEl.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);

      // Update Icon & Text
      if (themeIcon) {
        themeIcon.innerText = next === "dark" ? "‚òÄÔ∏è" : "üåô";
      }
      if (themeBtn) {
        const span = themeBtn.querySelector("span:last-child");
        if (span)
          span.innerText = next === "dark" ? "Light Mode" : "Dark Mode";
      }
    }
  </script>
</body>

</html>