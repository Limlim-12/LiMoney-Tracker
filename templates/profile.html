{% extends "base.html" %} {% block title %}Profile & Wallet - LiMoney{% endblock
%} {% block content %}
<div class="profile-wrapper">
  <div class="profile-hero">
    <div class="profile-avatar">
      <span>
        {{ (profile.firstname or 'U')[0] | upper }}{{ (profile.surname or
        'U')[0] | upper }}
      </span>
    </div>
    <div class="profile-info">
      <h1>
        {{ profile.firstname or 'Hello' }} {{ profile.surname or 'Friend' }}
      </h1>
      <p class="username">@{{ username }}</p>
      <div class="profile-badges">
        <span class="badge"
          >{{ profile.occupation or 'Occupation Not Set' }}</span
        >
        <span class="badge salary"
          >‚Ç±{{ "%.2f"|format(profile.salary) }} / mo</span
        >
      </div>
    </div>
  </div>

  <div class="wallet-section">
    <div class="wallet-header">
      <div style="display: flex; align-items: center; gap: 10px">
        <h3>üí≥ Digital Wallet</h3>
        <button
          class="privacy-btn"
          onclick="toggleWalletPrivacy()"
          title="Hide/Show Balances"
        >
          üëÅÔ∏è
        </button>
      </div>
      <button class="add-card-btn" onclick="openCardModal()">
        <span style="font-size: 1.2rem; line-height: 0; margin-bottom: 2px"
          >+</span
        >
        Add Card
      </button>
    </div>

    <div class="cards-carousel">
      {% if cards %} {% for card in cards %}
      <div class="credit-card {{ card.color_theme }}">
        <div class="card-shine"></div>
        <div class="card-top">
          <span class="bank-name">{{ card.bank_name }}</span>
          {% if 'Visa' in card.bank_name or 'Visa' in card.card_type %}
          <svg class="card-logo" viewBox="0 0 48 16" fill="white">
            <path
              d="M19.3 2.6h-2.9c-.5 0-.9.2-1.1.9l-3.2 7.7h2l.4-1.1h2.5l.2 1.1h1.8L19.3 2.6zm-3.3 5.3l1.1-3 0 0 .7 3h-1.8zm6 2.4h1.7l1.1-6.8h-1.7l-1.1 6.8zm5.9-6.9c-.9 0-1.6.3-1.9.9v-.8h-1.6l-.8 3.7-.6 3h1.7l.4-2c.1-.5.5-.7 1-.7.4 0 .7.1.9.3l.2-1.1c-.2-.2-.7-.3-1.3-.3zm5.7 1.3l.4-1.3h1.8l-1 4.8c-.2.7-.6 1.4-1.5 1.7-.5.2-1 .2-1.4.1l.3-1.2c.2 0 .5 0 .7-.1.3-.1.5-.4.6-.7l.1-.4-2.2-4.5h1.9l1 2.5 0 0 .3-2.5zM6.9 2.6H4.6L2.3 8.7l-.2-1.2c-.4-1.3-1.6-1.8-2.1-1.9l1.4 5.3 0 0 .3.8h2l3.2-7.8v-.1z"
            />
          </svg>
          {% elif 'Master' in card.bank_name or 'Master' in card.card_type %}
          <svg class="card-logo" viewBox="0 0 24 16" fill="none">
            <circle cx="7" cy="8" r="7" fill="#EB001B" fill-opacity="0.9" />
            <circle cx="17" cy="8" r="7" fill="#F79E1B" fill-opacity="0.9" />
            <path
              d="M12 12.5C13.6569 12.5 15.1569 11.8284 16.2426 10.7426C17.3284 9.65685 18 8.15685 18 6.5C18 4.84315 17.3284 3.34315 16.2426 2.25736C15.1569 1.17157 13.6569 0.5 12 0.5C10.3431 0.5 8.84315 1.17157 7.75736 2.25736C6.67157 3.34315 6 4.84315 6 6.5C6 8.15685 6.67157 9.65685 7.75736 10.7426C8.84315 11.8284 10.3431 12.5 12 12.5Z"
              fill="#FF5F00"
              fill-opacity="0"
            />
          </svg>
          {% else %}
          <span class="card-type">{{ card.card_type }}</span>
          {% endif %}
        </div>
        <div class="card-chip">
          <div class="chip-line"></div>
          <div class="chip-line"></div>
          <div class="chip-line"></div>
          <div class="chip-line"></div>
        </div>
        <div class="card-number">
          <span>‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span> <span>‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span> <span>‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
          <span>{{ card.last_four }}</span>
        </div>
        <div class="card-bottom">
          <div class="card-balance">
            <small>Available Balance</small>
            <span>‚Ç±{{ "%.2f"|format(card.balance) }}</span>
          </div>
          <div class="card-usage-tag">{{ card.usage_tag }}</div>
        </div>

        <form
          action="{{ url_for('delete_card', id=card.id) }}"
          method="POST"
          class="card-delete-form"
          onsubmit="return confirmAction(event, this, '{{ card.bank_name }}', 'Card')"
        >
          <button type="submit" class="card-delete-btn" title="Remove Card">
            √ó
          </button>
        </form>
      </div>
      {% endfor %} {% else %}
      <div class="empty-wallet">
        <div class="empty-card-placeholder">
          <span>+</span>
        </div>
        <p>No cards added yet.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="profile-forms-grid">
    <div class="profile-card personal">
      <div class="card-header">
        <h3>üìù Personal Details</h3>
      </div>

      <form
        method="POST"
        action="{{ url_for('profile') }}"
        class="premium-form"
      >
        <input type="hidden" name="form_type" value="personal" />

        <div class="form-row">
          <div class="input-group">
            <label class="form-label">First Name</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üë§</span>
              <input
                type="text"
                name="firstname"
                value="{{ profile.firstname }}"
                required
                class="premium-input"
                placeholder="Enter first name"
              />
            </div>
          </div>
          <div class="input-group">
            <label class="form-label">Surname</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üë§</span>
              <input
                type="text"
                name="surname"
                value="{{ profile.surname }}"
                required
                class="premium-input"
                placeholder="Enter surname"
              />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="input-group">
            <label class="form-label">Middle Initial</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üî§</span>
              <input
                type="text"
                name="middle_initial"
                value="{{ profile.middle_initial }}"
                maxlength="2"
                class="premium-input"
                placeholder="M.I."
              />
            </div>
          </div>
          <div class="input-group">
            <label class="form-label">Nickname</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üè∑Ô∏è</span>
              <input
                type="text"
                name="nickname"
                value="{{ profile.nickname }}"
                class="premium-input"
                placeholder="Call sign"
              />
            </div>
          </div>
        </div>

        <button type="submit" class="premium-save-btn">
          Save Personal Info
        </button>
      </form>
    </div>

    <div class="profile-card work">
      <div class="card-header">
        <h3>üíº Work & Income</h3>
      </div>

      <form
        method="POST"
        action="{{ url_for('profile') }}"
        class="premium-form"
      >
        <input type="hidden" name="form_type" value="work" />

        <div class="form-row">
          <div class="input-group">
            <label class="form-label">Occupation</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üë®‚Äçüíª</span>
              <input
                type="text"
                name="occupation"
                value="{{ profile.occupation }}"
                class="premium-input"
                placeholder="Job Title"
              />
            </div>
          </div>
          <div class="input-group">
            <label class="form-label">Company</label>
            <div class="input-wrapper">
              <span class="input-icon-span">üè¢</span>
              <input
                type="text"
                name="company"
                value="{{ profile.company }}"
                class="premium-input"
                placeholder="Company Name"
              />
            </div>
          </div>
        </div>

        <div class="input-group">
          <label class="form-label">Monthly Salary (‚Ç±)</label>
          <div class="input-wrapper">
            <span class="input-icon-span">üí∞</span>
            <input
              type="number"
              name="salary"
              step="0.01"
              value="{{ profile.salary }}"
              class="premium-input"
              placeholder="0.00"
            />
          </div>
        </div>

        <button type="submit" class="premium-save-btn">Update Work Info</button>
      </form>
    </div>
  </div>
</div>

<div id="cardModal" class="modal-overlay" style="display: none">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üí≥ Add New Card</h3>
      <button onclick="closeCardModal()" class="close-modal-btn">√ó</button>
    </div>
    <form method="POST" action="{{ url_for('add_card') }}" class="tool-form">
      <div class="form-group">
        <label>Bank Name</label>
        <input
          type="text"
          name="bank_name"
          placeholder="BDO, BPI, GCash..."
          required
          class="tool-input"
        />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Card Type</label>
          <select name="card_type" class="tool-select">
            <option value="Debit">Debit</option>
            <option value="Credit">Credit</option>
            <option value="Prepaid">Prepaid</option>
          </select>
        </div>
        <div class="form-group">
          <label>Last 4 Digits</label>
          <input
            type="text"
            name="last_four"
            placeholder="1234"
            maxlength="4"
            required
            class="tool-input"
          />
        </div>
      </div>
      <div class="form-group">
        <label>Current Balance (‚Ç±)</label>
        <input
          type="number"
          step="0.01"
          name="balance"
          placeholder="0.00"
          required
          class="tool-input"
        />
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Card Style</label>
          <select name="color_theme" class="tool-select">
            <option value="blue">Classic Blue</option>
            <option value="gold">Gold Premium</option>
            <option value="black">Matte Black</option>
            <option value="platinum">Platinum</option>
            <option value="orange">Neon Orange (Maribank)</option>
            <option value="cyan">Cyan Black (GoTyme)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Usage Tag</label>
          <input
            type="text"
            name="usage_tag"
            placeholder="Grocery, Gas..."
            required
            class="tool-input"
          />
        </div>
      </div>
      <button type="submit" class="tool-btn">Add to Wallet</button>
    </form>
  </div>
</div>

<div id="confirmModal" class="modal-overlay" style="display: none">
  <div class="modal-content confirmation">
    <div class="confirm-icon-bg">‚ö†Ô∏è</div>
    <h3 class="confirm-title" id="confirmTitle">Delete Item?</h3>
    <p class="confirm-text" id="confirmText">
      Are you sure you want to remove this? This action cannot be undone.
    </p>
    <div class="confirm-actions">
      <button class="btn-cancel" onclick="closeConfirmModal()">Cancel</button>
      <button class="btn-confirm-delete" onclick="executeDelete()">
        Yes, Delete
      </button>
    </div>
  </div>
</div>

<script>
  // --- 1. Confirmation Modal Logic ---
  let formToDelete = null;

  function confirmAction(event, form, name, type) {
    event.preventDefault(); // Stop default form submit
    formToDelete = form;

    // Update Modal Text
    document.getElementById("confirmTitle").innerText = `Delete ${type}?`;
    document.getElementById("confirmText").innerText =
      `Are you sure you want to delete "${name}"? This action cannot be undone.`;

    // Show Modal
    document.getElementById("confirmModal").style.display = "flex";
  }

  function executeDelete() {
    if (formToDelete) {
      formToDelete.submit(); // Actually delete
    }
  }

  function closeConfirmModal() {
    document.getElementById("confirmModal").style.display = "none";
    formToDelete = null;
  }

  // --- 2. Card Modal Logic ---
  function openCardModal() {
    document.getElementById("cardModal").style.display = "flex";
  }
  function closeCardModal() {
    document.getElementById("cardModal").style.display = "none";
  }

  // --- 3. Close on background click (Global) ---
  window.onclick = function (event) {
    if (event.target.classList.contains("modal-overlay")) {
      event.target.style.display = "none";
    }
  };

  // --- 1. Privacy Toggle ---
  function toggleWalletPrivacy() {
    const walletSection = document.querySelector(".wallet-section");
    walletSection.classList.toggle("privacy-active");

    // Optional: Change icon based on state
    const btn = document.querySelector(".privacy-btn");
    if (walletSection.classList.contains("privacy-active")) {
      btn.innerText = "üîí";
    } else {
      btn.innerText = "üëÅÔ∏è";
    }
  }

  // --- 2. Premium 3D Tilt Effect ---
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".credit-card");

    cards.forEach((card) => {
      card.addEventListener("mousemove", (e) => {
        // Get card dimensions
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Calculate center
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        // Calculate rotation (Max 15 degrees)
        const rotateX = ((y - centerY) / centerY) * -15;
        const rotateY = ((x - centerX) / centerX) * 15;

        // Apply 3D Transform
        card.classList.add("moving");
        card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;

        // Move shine effect based on mouse
        const shine = card.querySelector(".card-shine");
        if (shine) {
          shine.style.transform = `translateX(${rotateY * 2}px)`;
          shine.style.opacity = "0.3";
        }
      });

      // Reset on mouse leave
      card.addEventListener("mouseleave", () => {
        card.classList.remove("moving");
        card.style.transform =
          "perspective(1000px) rotateX(0) rotateY(0) scale(1)";

        const shine = card.querySelector(".card-shine");
        if (shine) shine.style.opacity = "0";
      });
    });
  });
</script>
{% endblock %}
